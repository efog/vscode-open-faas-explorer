name: $(Year:yy).$(DayOfYear).vscode-open-faas-explorer.$(Build.SourceBranchName).$(Rev:rr)
trigger:
- master
pool:
  vmImage: 'windows-latest'
steps:
- task: NodeTool@0
  inputs:
    versionSpec: '10.x'
  displayName: 'Install Node.js'
- bash: |
    npm install -g vsce
  displayName: Install VSCE packager
- bash: |
    npm install
  displayName: Install Node.js dependencies
- task: Npm@1
  inputs:
    command: custom
    customCommand: test 
  displayName: Run unit tests
  continueOnError: true
- task: PublishTestResults@2
  condition: succeededOrFailed()
  inputs:
    testRunner: JUnit
    testResultsFiles: '**/test/test-results.xml'
- bash: |
    vsce package minor
  displayName: Package VSIX
- task: PublishBuildArtifacts@1
  inputs:
    ArtifactName: open-faas-explorer-vsix
    PathtoPublish: open-faas-explorer-1.0.0.vsix